<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="utf-8">
	<meta name="viewport"content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
	<link rel="stylesheet" href="/drogaria/assets/css/style.css">
	<title>Farmácia Bem-estar</title>
	<link rel="icon" type="image/x-icon" href="/drogaria/assets/images/favicon.ico">
</head>
<body>
<div id="header-placeholder"></div>
	
<div id="lista-medicamentos" class="container mt-5" style="min-height: 80vh"></div>
<div id="modais-container"></div>
	
<div id="footer-placeholder"></div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="/drogaria/assets/js/header_footer_include.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="/drogaria/assets/js/sweet_alerts.js"></script>
<script src="/drogaria/assets/js/exibe_mensagem.js"></script>
<script src="/drogaria/assets/js/medicamento.js"></script>
<script>
    let listaDeCategorias = []; // Necessário para o modal de edição, que ainda pode ser usado

    document.addEventListener('footer-carregado', async () => {
        const container = document.getElementById('lista-medicamentos');
        container.innerHTML = '<h2>Carregando...</h2>';
        
        const usuarioLogadoJSON = sessionStorage.getItem("usuarioLogado");
        const usuarioLogado = usuarioLogadoJSON ? JSON.parse(usuarioLogadoJSON) : null;

        if (!usuarioLogado || !usuarioLogado.isAdmin) {
            container.innerHTML = '<h2>Acesso Negado.</h2>';
            return;
        }

        try {
            const response = await fetch('/drogaria/ReadMedicamentoServlet');
            if (!response.ok) throw new Error('Erro ao carregar medicamentos.');
            const listaMedicamentos = await response.json();
            
            container.innerHTML = ''; // Limpa o "Carregando..."

            const headerDiv = document.createElement('div');
            headerDiv.className = 'col-md-12 row d-flex align-items-center mb-4';
            headerDiv.innerHTML = `<h2 class="txt-cyan col-md-6 col-sm-12">Gerenciar Medicamentos</h2>
                                   <a href="/drogaria/medicamento/form-medicamento.html" class="btn col-md-6 col-sm-12 bg-cyan custom-gradient p-3 text-right font-weight-bold">
                                     <i class="fas fa-plus-circle"></i> Cadastrar medicamento
                                   </a>`;
            container.appendChild(headerDiv);

            if (!listaMedicamentos || listaMedicamentos.length === 0) {
                 container.innerHTML += `<p class="text-center text-muted">Nenhum medicamento encontrado.</p>`;
                 return;
            }

            const rowDiv = document.createElement('div');
            rowDiv.className = 'row';
            container.appendChild(rowDiv);

            listaMedicamentos.forEach(med => {
                const card = criaCard(med, usuarioLogado);
                rowDiv.appendChild(card);
            });

        } catch (error) {
            container.innerHTML = '<h2>Erro inesperado ao carregar medicamentos.</h2>';
            console.error(error);
        }
    });
</script>
</body>
</html>
